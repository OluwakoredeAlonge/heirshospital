<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visit History - Methuselah Project</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        [x-cloak] { display: none !important; }
        
        /* Timeline Styling */
        .timeline-line {
            position: absolute;
            left: 20px;
            top: 60px;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, #9333ea, #e0e7ff);
        }
        
        @media (max-width: 768px) {
            .timeline-line {
                left: 15px;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen" x-data="{ 
    mobileMenuOpen: false,
    expandedVisit: null,
    compareMode: false,
    selectedVisitsForCompare: [],
    showVisitModal: false,
    selectedVisit: null,
    filterType: 'all',
    dateRange: 'all',
    
    patient: {
        id: 'MTP-2024-001',
        name: 'Mrs. Adebayo Folake',
        age: 72,
        gender: 'Female',
        phone: '08012345678',
        registrationDate: '2024-01-15',
        totalVisits: 8,
        conditions: ['Hypertension', 'Arthritis']
    },
    
    visits: [
        {
            id: 1,
            date: '2024-12-08',
            time: '10:30 AM',
            type: 'Follow-up Visit',
            clinician: 'Dr. Adeyemi',
            complaints: 'Routine hypertension check, mild headache in the mornings',
            vitals: {
                bp: '130/85 mmHg',
                pulse: '78 bpm',
                temp: '36.8°C',
                weight: '68 kg',
                bmi: '24.5',
                respiratory: '16 cpm'
            },
            diagnosis: 'Essential Hypertension - Controlled',
            differentialDiagnosis: 'Tension headache, Medication side effects',
            medications: [
                { name: 'Amlodipine', dose: '5mg', frequency: 'Once daily', duration: '30 days' },
                { name: 'Hydrochlorothiazide', dose: '12.5mg', frequency: 'Once daily', duration: '30 days' },
                { name: 'Paracetamol', dose: '500mg', frequency: 'As needed', duration: '7 days' }
            ],
            investigations: [
                { test: 'Blood Pressure', result: '130/85 mmHg', status: 'normal' },
                { test: 'Random Blood Sugar', result: '98 mg/dL', status: 'normal' },
                { test: 'Urinalysis', result: 'Normal', status: 'normal' }
            ],
            systemicExam: {
                cvs: 'S1 S2 heard, no murmurs',
                respiratory: 'Clear breath sounds bilaterally',
                abdomen: 'Soft, non-tender',
                cns: 'Alert and oriented x3'
            },
            healthEducation: ['Medication adherence', 'Low salt diet', 'Regular exercise', 'Stress management'],
            nextVisit: '2025-01-18',
            notes: 'Patient reports good compliance with medications. BP well controlled. Advised to continue current regimen and monitor for any changes.',
            status: 'completed'
        },
        {
            id: 2,
            date: '2024-11-02',
            time: '11:00 AM',
            type: 'Follow-up Visit',
            clinician: 'Dr. Adeyemi',
            complaints: 'Joint pain in knees, occasional dizziness',
            vitals: {
                bp: '135/88 mmHg',
                pulse: '82 bpm',
                temp: '37.0°C',
                weight: '69 kg',
                bmi: '24.8',
                respiratory: '18 cpm'
            },
            diagnosis: 'Essential Hypertension, Osteoarthritis of knees',
            differentialDiagnosis: 'Postural hypotension, Rheumatoid arthritis',
            medications: [
                { name: 'Amlodipine', dose: '5mg', frequency: 'Once daily', duration: '30 days' },
                { name: 'Ibuprofen', dose: '400mg', frequency: 'Twice daily after meals', duration: '14 days' },
                { name: 'Calcium supplement', dose: '500mg', frequency: 'Once daily', duration: '30 days' }
            ],
            investigations: [
                { test: 'Blood Pressure', result: '135/88 mmHg', status: 'borderline' },
                { test: 'Hemoglobin', result: '12.5 g/dL', status: 'normal' }
            ],
            systemicExam: {
                cvs: 'Normal heart sounds',
                respiratory: 'Normal air entry',
                musculoskeletal: 'Tenderness on palpation of both knees, crepitus present',
                cns: 'Intact'
            },
            healthEducation: ['Weight management', 'Joint care exercises', 'Medication timing'],
            nextVisit: '2024-12-02',
            notes: 'Added pain management for arthritis. Patient advised on gentle exercises and weight management.',
            status: 'completed'
        },
        {
            id: 3,
            date: '2024-09-21',
            time: '10:00 AM',
            type: 'Primary Visit',
            clinician: 'Dr. Adeyemi',
            complaints: 'Persistent headaches, occasional chest tightness',
            vitals: {
                bp: '145/92 mmHg',
                pulse: '85 bpm',
                temp: '37.1°C',
                weight: '70 kg',
                bmi: '25.2',
                respiratory: '19 cpm'
            },
            diagnosis: 'Essential Hypertension - Newly diagnosed',
            differentialDiagnosis: 'Secondary hypertension, Anxiety disorder',
            medications: [
                { name: 'Amlodipine', dose: '5mg', frequency: 'Once daily', duration: '30 days' },
                { name: 'Aspirin', dose: '75mg', frequency: 'Once daily', duration: '30 days' }
            ],
            investigations: [
                { test: 'Blood Pressure', result: '145/92 mmHg', status: 'high' },
                { test: 'ECG', result: 'Normal sinus rhythm', status: 'normal' },
                { test: 'FBS', result: '105 mg/dL', status: 'normal' },
                { test: 'Lipid Profile', result: 'Ordered', status: 'pending' }
            ],
            systemicExam: {
                cvs: 'Regular rhythm, no murmurs',
                respiratory: 'Clear lung fields',
                abdomen: 'No organomegaly',
                cns: 'Neurologically intact'
            },
            healthEducation: ['Hypertension education', 'Dietary modifications', 'Exercise importance', 'Medication adherence'],
            nextVisit: '2024-10-21',
            notes: 'New diagnosis of hypertension. Extensive counseling provided. Patient educated on lifestyle modifications and importance of compliance.',
            status: 'completed'
        },
        {
            id: 4,
            date: '2024-08-10',
            time: '09:30 AM',
            type: 'Screening Visit',
            clinician: 'Dr. Adeyemi',
            complaints: 'General health check-up, no specific complaints',
            vitals: {
                bp: '140/90 mmHg',
                pulse: '80 bpm',
                temp: '36.9°C',
                weight: '71 kg',
                bmi: '25.5',
                respiratory: '17 cpm'
            },
            diagnosis: 'Pre-hypertension, Overweight',
            differentialDiagnosis: 'Essential hypertension',
            medications: [
                { name: 'Lifestyle modifications', dose: 'N/A', frequency: 'Continuous', duration: 'Ongoing' }
            ],
            investigations: [
                { test: 'Blood Pressure', result: '140/90 mmHg', status: 'borderline' },
                { test: 'Random Blood Sugar', result: '110 mg/dL', status: 'normal' },
                { test: 'BMI', result: '25.5', status: 'borderline' }
            ],
            systemicExam: {
                general: 'Well-nourished elderly female',
                cvs: 'Normal',
                respiratory: 'Normal',
                abdomen: 'Normal'
            },
            healthEducation: ['Weight reduction', 'Regular BP monitoring', 'Healthy diet', 'Physical activity'],
            nextVisit: '2024-09-10',
            notes: 'Screening visit. Blood pressure borderline high. Advised lifestyle modifications and follow-up in 4 weeks.',
            status: 'completed'
        },
        {
            id: 5,
            date: '2024-07-15',
            time: '11:30 AM',
            type: 'Initial Registration',
            clinician: 'Dr. Adeyemi',
            complaints: 'Program registration and baseline assessment',
            vitals: {
                bp: '138/88 mmHg',
                pulse: '78 bpm',
                temp: '36.8°C',
                weight: '72 kg',
                bmi: '25.9',
                respiratory: '16 cpm'
            },
            diagnosis: 'Initial Assessment - No acute complaints',
            differentialDiagnosis: 'N/A',
            medications: [],
            investigations: [
                { test: 'Baseline BP', result: '138/88 mmHg', status: 'borderline' },
                { test: 'General Physical Exam', result: 'Normal', status: 'normal' }
            ],
            systemicExam: {
                general: 'Elderly female in good general condition',
                cvs: 'Normal',
                respiratory: 'Normal',
                abdomen: 'Normal',
                musculoskeletal: 'Normal gait, no obvious deformities'
            },
            healthEducation: ['Program orientation', 'Health screening importance', 'Appointment scheduling'],
            nextVisit: '2024-08-15',
            notes: 'Initial registration into Methuselah Project. Baseline vitals recorded. Patient oriented to program benefits and schedule.',
            status: 'completed'
        }
    ],
    
    get filteredVisits() {
        let filtered = this.visits;
        
        if (this.filterType !== 'all') {
            filtered = filtered.filter(v => v.type === this.filterType);
        }
        
        if (this.dateRange === '3months') {
            const threeMonthsAgo = new Date();
            threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);
            filtered = filtered.filter(v => new Date(v.date) >= threeMonthsAgo);
        } else if (this.dateRange === '6months') {
            const sixMonthsAgo = new Date();
            sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
            filtered = filtered.filter(v => new Date(v.date) >= sixMonthsAgo);
        }
        
        return filtered;
    },
    
    toggleExpand(visitId) {
        this.expandedVisit = this.expandedVisit === visitId ? null : visitId;
    },
    
    viewVisitDetails(visit) {
        this.selectedVisit = visit;
        this.showVisitModal = true;
    },
    
    toggleCompareVisit(visitId) {
        if (this.selectedVisitsForCompare.includes(visitId)) {
            this.selectedVisitsForCompare = this.selectedVisitsForCompare.filter(id => id !== visitId);
        } else if (this.selectedVisitsForCompare.length < 2) {
            this.selectedVisitsForCompare.push(visitId);
        }
    },
    
    compareVisits() {
        if (this.selectedVisitsForCompare.length === 2) {
            alert('Comparing visits: ' + this.selectedVisitsForCompare.join(' and '));
        }
    },
    
    printVisit(visit) {
        alert('Printing visit record for: ' + visit.date);
    },
    
    exportTimeline() {
        alert('Exporting complete visit timeline to PDF...');
    }
}">
    
    <!-- Top Navbar -->
    <nav class="bg-white shadow-lg sticky top-0 z-50 border-b-4 border-purple-600">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-600 to-purple-800 rounded-xl flex items-center justify-center shadow-lg">
                        <i data-lucide="heart" class="w-6 h-6 text-white"></i>
                    </div>
                    <div class="hidden sm:block">
                        <h1 class="text-xl font-bold text-gray-800">Methuselah Project</h1>
                        <p class="text-xs text-gray-500">Elderly Care Program</p>
                    </div>
                </div>

                <div class="hidden lg:flex items-center space-x-1">
                    <a href="#" class="px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 font-medium text-sm transition">
                        <i data-lucide="layout-dashboard" class="w-4 h-4 inline mr-2"></i>Dashboard
                    </a>
                    <a href="#" class="px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 font-medium text-sm transition">
                        <i data-lucide="users" class="w-4 h-4 inline mr-2"></i>Patients
                    </a>
                    <a href="#" class="px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 font-medium text-sm transition">
                        <i data-lucide="calendar" class="w-4 h-4 inline mr-2"></i>Appointments
                    </a>
                    <a href="#" class="px-4 py-2 rounded-lg bg-purple-100 text-purple-700 font-medium text-sm">
                        <i data-lucide="clipboard-list" class="w-4 h-4 inline mr-2"></i>Visits
                    </a>
                    <a href="#" class="px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 font-medium text-sm transition">
                        <i data-lucide="bar-chart-3" class="w-4 h-4 inline mr-2"></i>Reports
                    </a>
                </div>

                <div class="flex items-center space-x-3">
                    <button class="relative p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition">
                        <i data-lucide="bell" class="w-5 h-5"></i>
                    </button>
                    <div class="hidden sm:flex items-center space-x-2 pl-3 border-l border-gray-200">
                        <div class="w-9 h-9 bg-gradient-to-br from-purple-500 to-purple-700 rounded-full flex items-center justify-center">
                            <span class="text-sm font-bold text-white">DA</span>
                        </div>
                        <div class="hidden lg:block">
                            <p class="text-sm font-medium text-gray-800">Dr. Adeyemi</p>
                            <p class="text-xs text-gray-500">Clinician</p>
                        </div>
                    </div>
                    <button @click="mobileMenuOpen = !mobileMenuOpen" class="lg:hidden p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
        
        <!-- Breadcrumb -->
        <div class="flex items-center space-x-2 text-sm text-gray-500 mb-6">
            <a href="#" class="hover:text-purple-600">Dashboard</a>
            <i data-lucide="chevron-right" class="w-4 h-4"></i>
            <a href="#" class="hover:text-purple-600">Patients</a>
            <i data-lucide="chevron-right" class="w-4 h-4"></i>
            <span class="text-purple-600 font-medium">Visit History</span>
        </div>

        <!-- Patient Header Card -->
        <div class="bg-gradient-to-r from-purple-600 to-indigo-700 rounded-2xl shadow-xl mb-6 overflow-hidden">
            <div class="p-6 sm:p-8">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
                    <div class="flex items-start space-x-4">
                        <div class="w-20 h-20 bg-white bg-opacity-20 backdrop-blur-sm rounded-2xl flex items-center justify-center flex-shrink-0">
                            <i data-lucide="user" class="w-10 h-10 text-white"></i>
                        </div>
                        <div class="text-white">
                            <h2 class="text-2xl sm:text-3xl font-bold mb-2" x-text="patient.name"></h2>
                            <div class="flex flex-wrap gap-4 text-sm text-purple-100">
                                <span class="flex items-center">
                                    <i data-lucide="hash" class="w-4 h-4 mr-1"></i>
                                    <span x-text="patient.id"></span>
                                </span>
                                <span class="flex items-center">
                                    <i data-lucide="calendar" class="w-4 h-4 mr-1"></i>
                                    <span x-text="patient.age + ' years'"></span>
                                </span>
                                <span class="flex items-center">
                                    <i data-lucide="phone" class="w-4 h-4 mr-1"></i>
                                    <span x-text="patient.phone"></span>
                                </span>
                            </div>
                            <div class="flex flex-wrap gap-2 mt-3">
                                <template x-for="condition in patient.conditions">
                                    <span class="bg-white bg-opacity-20 backdrop-blur-sm px-3 py-1 rounded-full text-xs font-medium" x-text="condition"></span>
                                </template>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button class="bg-white text-purple-700 px-6 py-3 rounded-xl font-semibold hover:bg-purple-50 transition shadow-lg flex items-center justify-center space-x-2">
                            <i data-lucide="plus" class="w-5 h-5"></i>
                            <span>New Visit</span>
                        </button>
                        <button @click="exportTimeline" class="bg-purple-800 bg-opacity-50 text-white px-6 py-3 rounded-xl font-semibold hover:bg-opacity-70 transition backdrop-blur-sm flex items-center justify-center space-x-2">
                            <i data-lucide="download" class="w-5 h-5"></i>
                            <span>Export</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                <div class="flex items-center justify-between mb-2">
                    <div class="bg-blue-100 rounded-lg p-2">
                        <i data-lucide="calendar-check" class="w-5 h-5 text-blue-600"></i>
                    </div>
                </div>
                <p class="text-2xl font-bold text-gray-900" x-text="patient.totalVisits"></p>
                <p class="text-xs text-gray-500 mt-1">Total Visits</p>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                <div class="flex items-center justify-between mb-2">
                    <div class="bg-green-100 rounded-lg p-2">
                        <i data-lucide="activity" class="w-5 h-5 text-green-600"></i>
                    </div>
                </div>
                <p class="text-2xl font-bold text-gray-900">130/85</p>
                <p class="text-xs text-gray-500 mt-1">Latest BP</p>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                <div class="flex items-center justify-between mb-2">
                    <div class="bg-purple-100 rounded-lg p-2">
                        <i data-lucide="pill" class="w-5 h-5 text-purple-600"></i>
                    </div>
                </div>
                <p class="text-2xl font-bold text-gray-900">3</p>
                <p class="text-xs text-gray-500 mt-1">Current Meds</p>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
                <div class="flex items-center justify-between mb-2">
                    <div class="bg-orange-100 rounded-lg p-2">
                        <i data-lucide="clock" class="w-5 h-5 text-orange-600"></i>
                    </div>
                </div>
                <p class="text-2xl font-bold text-gray-900">Jan 18</p>
                <p class="text-xs text-gray-500 mt-1">Next Visit</p>
            </div>
        </div>

        <!-- Filters and Actions Bar -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-4 sm:p-6 mb-6">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                <div class="flex flex-col sm:flex-row gap-3 flex-1">
                    <!-- Visit Type Filter -->
                    <select 
                        x-model="filterType"
                        class="px-4 py-2.5 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm font-medium"
                    >
                        <option value="all">All Visit Types</option>
                        <option value="Follow-up Visit">Follow-up Visit</option>
                        <option value="Primary Visit">Primary Visit</option>
                        <option value="Screening Visit">Screening Visit</option>
                        <option value="Initial Registration">Initial Registration</option>
                    </select>

                    <!-- Date Range Filter -->
                    <select 
                        x-model="dateRange"
                        class="px-4 py-2.5 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm font-medium"
                    >
                        <option value="all">All Time</option>
                        <option value="3months">Last 3 Months</option>
                        <option value="6months">Last 6 Months</option>
                    </select>

                    <!-- Compare Mode Toggle -->
                    <button 
                        @click="compareMode = !compareMode; selectedVisitsForCompare = []"
                        :class="compareMode ? 'bg-purple-600 text-white' : 'bg-gray-100 text-gray-700'"
                        class="px-4 py-2.5 rounded-xl font-medium transition flex items-center justify-center space-x-2"
                    >
                        <i data-lucide="git-compare" class="w-4 h-4"></i>
                        <span class="text-sm">Compare Mode</span>
                    </button>
                </div>

                <div class="flex items-center gap-3">
                    <span class="text-sm text-gray-600">
                        Showing <strong x-text="filteredVisits.length"></strong> visit(s)
                    </span>
                </div>
            </div>

            <!-- Compare Actions -->
            <div 
                x-show="compareMode && selectedVisitsForCompare.length > 0"
                x-transition
                class="mt-4 pt-4 border-t border-gray-200 flex items-center justify-between"
                x-cloak
            >
                <p class="text-sm font-semibold text-gray-700">
                    <span x-text="selectedVisitsForCompare.length"></span> visit(s) selected for comparison
                </p>
                <button 
                    @click="compareVisits"
                    :disabled="selectedVisitsForCompare.length !== 2"
                    :class="selectedVisitsForCompare.length === 2 ? 'bg-purple-600 hover:bg-purple-700' : 'bg-gray-300 cursor-not-allowed'"
                    class="px-6 py-2.5 text-white rounded-xl font-semibold transition flex items-center space-x-2"
                >
                    <i data-lucide="git-compare" class="w-4 h-4"></i>
                    <span>Compare Selected</span>
                </button>
            </div>
        </div>

        <!-- Timeline Container -->
        <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6 sm:p-8">
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center space-x-3">
                    <div class="bg-purple-100 rounded-lg p-2">
                        <i data-lucide="clock" class="w-6 h-6 text-purple-600"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-900">Visit Timeline</h3>
                        <p class="text-sm text-gray-500">Complete medical history</p>
                    </div>
                </div>
            </div>

            <!-- Timeline -->
            <div class="relative pl-12 sm:pl-16">
                <!-- Timeline Line -->
                <div class="timeline-line"></div>

                <!-- Visit Cards -->
                <template x-for="(visit, index) in filteredVisits" :key="visit.id">
                    <div class="relative mb-8 last:mb-0">
                        <!-- Timeline Dot -->
                        <div 
                            class="absolute -left-12 sm:-left-16 w-10 h-10 rounded-full flex items-center justify-center shadow-lg z-10"
                            :class="{
                                'bg-gradient-to-br from-green-500 to-green-600': visit.type === 'Follow-up Visit',
                                'bg-gradient-to-br from-blue-500 to-blue-600': visit.type === 'Primary Visit',
                                'bg-gradient-to-br from-purple-500 to-purple-600': visit.type === 'Screening Visit',
                                'bg-gradient-to-br from-orange-500 to-orange-600': visit.type === 'Initial Registration'
                            }"
                        >
                            <i 
                                data-lucide="stethoscope" 
                                class="w-5 h-5 text-white"
                                x-init="$nextTick(() => lucide.createIcons())"
                            ></i>
                        </div>

                        <!-- Visit Card -->
                        <div 
                            class="border-2 rounded-2xl overflow-hidden transition-all hover:shadow-xl cursor-pointer"
                            :class="{
                                'border-purple-300 shadow-lg': compareMode && selectedVisitsForCompare.includes(visit.id),
                                'border-gray-200': !compareMode || !selectedVisitsForCompare.includes(visit.id)
                            }"
                            @click="compareMode ? toggleCompareVisit(visit.id) : toggleExpand(visit.id)"
                        >
                            <!-- Card Header -->
                            <div 
                                class="p-4 sm:p-6"
                                :class="{
                                    'bg-green-50': visit.type === 'Follow-up Visit',
                                    'bg-blue-50': visit.type === 'Primary Visit',
                                    'bg-purple-50': visit.type === 'Screening Visit',
                                    'bg-orange-50': visit.type === 'Initial Registration'
                                }"
                            >
                                <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-3 mb-2">
                                            <span 
                                                class="px-3 py-1 rounded-full text-xs font-bold"
                                                :class="{
                                                    'bg-green-200 text-green-800': visit.type === 'Follow-up Visit',
                                                    'bg-blue-200 text-blue-800': visit.type === 'Primary Visit',
                                                    'bg-purple-200 text-purple-800': visit.type === 'Screening Visit',
                                                    'bg-orange-200 text-orange-800': visit.type === 'Initial Registration'
                                                }"
                                                x-text="visit.type"
                                            ></span>
                                            <span 
                                                x-show="compareMode && selectedVisitsForCompare.includes(visit.id)"
                                                class="bg-purple-600 text-white px-2 py-1 rounded-full text-xs font-bold flex items-center space-x-1"
                                            >
                                                <i data-lucide="check" class="w-3 h-3"></i>
                                                <span>Selected</span>
                                            </span>
                                        </div>
                                        <h4 class="text-lg font-bold text-gray-900 mb-1" x-text="visit.date"></h4>
                                        <p class="text-sm text-gray-600 flex items-center">
                                            <i data-lucide="clock" class="w-4 h-4 mr-1"></i>
                                            <span x-text="visit.time + ' • ' + visit.clinician"></span>
                                        </p>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button 
                                            @click.stop="viewVisitDetails(visit)"
                                            class="p-2 hover:bg-white rounded-lg transition"
                                            title="View Full Details"
                                        >
                                            <i data-lucide="eye" class="w-5 h-5 text-gray-600"></i>
                                        </button>
                                        <button 
                                            @click.stop="printVisit(visit)"
                                            class="p-2 hover:bg-white rounded-lg transition"
                                            title="Print"
                                        >
                                            <i data-lucide="printer" class="w-5 h-5 text-gray-600"></i>
                                        </button>
                                        <button 
                                            @click.stop="toggleExpand(visit.id)"
                                            class="p-2 hover:bg-white rounded-lg transition"
                                        >
                                            <i 
                                                data-lucide="chevron-down" 
                                                class="w-5 h-5 text-gray-600 transition-transform"
                                                :class="{ 'rotate-180': expandedVisit === visit.id }"
                                            ></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Quick Summary -->
                                <div class="mt-4 grid grid-cols-2 sm:grid-cols-4 gap-3">
                                    <div class="bg-white rounded-lg p-3">
                                        <p class="text-xs text-gray-500 mb-1">Blood Pressure</p>
                                        <p class="text-sm font-bold text-gray-900" x-text="visit.vitals.bp"></p>
                                    </div>
                                    <div class="bg-white rounded-lg p-3">
                                        <p class="text-xs text-gray-500 mb-1">Pulse</p>
                                        <p class="text-sm font-bold text-gray-900" x-text="visit.vitals.pulse"></p>
                                    </div>
                                    <div class="bg-white rounded-lg p-3">
                                        <p class="text-xs text-gray-500 mb-1">Weight</p>
                                        <p class="text-sm font-bold text-gray-900" x-text="visit.vitals.weight"></p>
                                    </div>
                                    <div class="bg-white rounded-lg p-3">
                                        <p class="text-xs text-gray-500 mb-1">Temp</p>
                                        <p class="text-sm font-bold text-gray-900" x-text="visit.vitals.temp"></p>
                                    </div>
                                </div>
                            </div>

                            <!-- Expanded Content -->
                            <div 
                                x-show="expandedVisit === visit.id"
                                x-transition
                                class="border-t-2 border-gray-200"
                                x-cloak
                            >
                                <div class="p-6 space-y-6">
                                    <!-- Complaints -->
                                    <div>
                                        <h5 class="text-sm font-bold text-gray-900 mb-2 flex items-center">
                                            <i data-lucide="message-square" class="w-4 h-4 mr-2 text-purple-600"></i>
                                            Presenting Complaints
                                        </h5>
                                        <p class="text-sm text-gray-700 bg-gray-50 rounded-lg p-3" x-text="visit.complaints"></p>
                                    </div>

                                    <!-- Diagnosis -->
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <h5 class="text-sm font-bold text-gray-900 mb-2 flex items-center">
                                                <i data-lucide="clipboard" class="w-4 h-4 mr-2 text-green-600"></i>
                                                Diagnosis
                                            </h5>
                                            <p class="text-sm text-gray-700 bg-green-50 rounded-lg p-3 font-medium" x-text="visit.diagnosis"></p>
                                        </div>
                                        <div>
                                            <h5 class="text-sm font-bold text-gray-900 mb-2 flex items-center">
                                                <i data-lucide="clipboard-list" class="w-4 h-4 mr-2 text-orange-600"></i>
                                                Differential Diagnosis
                                            </h5>
                                            <p class="text-sm text-gray-700 bg-orange-50 rounded-lg p-3" x-text="visit.differentialDiagnosis"></p>
                                        </div>
                                    </div>

                                    <!-- Medications -->
                                    <div>
                                        <h5 class="text-sm font-bold text-gray-900 mb-3 flex items-center">
                                            <i data-lucide="pill" class="w-4 h-4 mr-2 text-purple-600"></i>
                                            Medications Prescribed
                                        </h5>
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                            <template x-for="med in visit.medications">
                                                <div class="bg-purple-50 rounded-lg p-3 border-l-4 border-purple-500">
                                                    <p class="text-sm font-bold text-gray-900" x-text="med.name"></p>
                                                    <p class="text-xs text-gray-600 mt-1">
                                                        <span x-text="med.dose"></span> • 
                                                        <span x-text="med.frequency"></span>
                                                    </p>
                                                    <p class="text-xs text-gray-500 mt-1">Duration: <span x-text="med.duration"></span></p>
                                                </div>
                                            </template>
                                        </div>
                                    </div>

                                    <!-- Investigations -->
                                    <div>
                                        <h5 class="text-sm font-bold text-gray-900 mb-3 flex items-center">
                                            <i data-lucide="flask-conical" class="w-4 h-4 mr-2 text-blue-600"></i>
                                            Investigations & Results
                                        </h5>
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-sm">
                                                <thead class="bg-gray-50 border-b border-gray-200">
                                                    <tr>
                                                        <th class="px-4 py-2 text-left font-semibold text-gray-700">Test</th>
                                                        <th class="px-4 py-2 text-left font-semibold text-gray-700">Result</th>
                                                        <th class="px-4 py-2 text-left font-semibold text-gray-700">Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="divide-y divide-gray-200">
                                                    <template x-for="test in visit.investigations">
                                                        <tr class="hover:bg-gray-50">
                                                            <td class="px-4 py-3 text-gray-900" x-text="test.test"></td>
                                                            <td class="px-4 py-3 text-gray-700 font-medium" x-text="test.result"></td>
                                                            <td class="px-4 py-3">
                                                                <span 
                                                                    class="px-2 py-1 rounded-full text-xs font-medium"
                                                                    :class="{
                                                                        'bg-green-100 text-green-700': test.status === 'normal',
                                                                        'bg-yellow-100 text-yellow-700': test.status === 'borderline',
                                                                        'bg-red-100 text-red-700': test.status === 'high',
                                                                        'bg-gray-100 text-gray-700': test.status === 'pending'
                                                                    }"
                                                                    x-text="test.status.charAt(0).toUpperCase() + test.status.slice(1)"
                                                                ></span>
                                                            </td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Systemic Examination -->
                                    <div>
                                        <h5 class="text-sm font-bold text-gray-900 mb-3 flex items-center">
                                            <i data-lucide="stethoscope" class="w-4 h-4 mr-2 text-red-600"></i>
                                            Systemic Examination
                                        </h5>
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                            <template x-for="(value, system) in visit.systemicExam">
                                                <div class="bg-gray-50 rounded-lg p-3">
                                                    <p class="text-xs font-bold text-gray-500 uppercase mb-1" x-text="system"></p>
                                                    <p class="text-sm text-gray-700" x-text="value"></p>
                                                </div>
                                            </template>
                                        </div>
                                    </div>

                                    <!-- Health Education -->
                                    <div>
                                        <h5 class="text-sm font-bold text-gray-900 mb-3 flex items-center">
                                            <i data-lucide="graduation-cap" class="w-4 h-4 mr-2 text-indigo-600"></i>
                                            Health Education Provided
                                        </h5>
                                        <div class="flex flex-wrap gap-2">
                                            <template x-for="topic in visit.healthEducation">
                                                <span class="bg-indigo-50 text-indigo-700 px-3 py-1.5 rounded-full text-xs font-medium flex items-center">
                                                    <i data-lucide="check" class="w-3 h-3 mr-1"></i>
                                                    <span x-text="topic"></span>
                                                </span>
                                            </template>
                                        </div>
                                    </div>

                                    <!-- Clinical Notes -->
                                    <div>
                                        <h5 class="text-sm font-bold text-gray-900 mb-2 flex items-center">
                                            <i data-lucide="file-text" class="w-4 h-4 mr-2 text-gray-600"></i>
                                            Clinical Notes
                                        </h5>
                                        <p class="text-sm text-gray-700 bg-gray-50 rounded-lg p-4 border-l-4 border-gray-400" x-text="visit.notes"></p>
                                    </div>

                                    <!-- Next Visit -->
                                    <div class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg p-4 border-2 border-purple-200">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-3">
                                                <div class="bg-purple-600 rounded-lg p-2">
                                                    <i data-lucide="calendar-check" class="w-5 h-5 text-white"></i>
                                                </div>
                                                <div>
                                                    <p class="text-xs font-semibold text-gray-500 uppercase">Next Visit Scheduled</p>
                                                    <p class="text-base font-bold text-gray-900" x-text="visit.nextVisit"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- No Results -->
                <div 
                    x-show="filteredVisits.length === 0"
                    class="text-center py-12"
                    x-cloak
                >
                    <div class="bg-gray-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="search" class="w-10 h-10 text-gray-400"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-900 mb-2">No Visits Found</h3>
                    <p class="text-sm text-gray-600">Try adjusting your filters</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Visit Details Modal -->
    <div 
        x-show="showVisitModal" 
        @click.self="showVisitModal = false"
        x-transition
        class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
        x-cloak
    >
        <div 
            @click.stop
            x-transition
            class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"
        >
            <template x-if="selectedVisit">
                <div>
                    <!-- Modal Header -->
                    <div 
                        class="sticky top-0 p-6 rounded-t-2xl z-10 border-b border-gray-200"
                        :class="{
                            'bg-green-600': selectedVisit.type === 'Follow-up Visit',
                            'bg-blue-600': selectedVisit.type === 'Primary Visit',
                            'bg-purple-600': selectedVisit.type === 'Screening Visit',
                            'bg-orange-600': selectedVisit.type === 'Initial Registration'
                        }"
                    >
                        <div class="flex items-start justify-between">
                            <div class="text-white">
                                <h3 class="text-2xl font-bold mb-2">Visit Details</h3>
                                <div class="flex items-center space-x-4 text-sm">
                                    <span x-text="selectedVisit.date"></span>
                                    <span>•</span>
                                    <span x-text="selectedVisit.time"></span>
                                    <span>•</span>
                                    <span x-text="selectedVisit.clinician"></span>
                                </div>
                            </div>
                            <button @click="showVisitModal = false" class="text-white hover:bg-white hover:bg-opacity-20 rounded-lg p-2 transition">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Modal Body -->
                    <div class="p-6 space-y-6">
                        <!-- Full Vitals Grid -->
                        <div>
                            <h4 class="text-lg font-bold text-gray-900 mb-4">Complete Vital Signs</h4>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                                <div class="bg-red-50 rounded-xl p-4 border border-red-200">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <i data-lucide="heart-pulse" class="w-5 h-5 text-red-600"></i>
                                        <p class="text-xs font-bold text-gray-600">Blood Pressure</p>
                                    </div>
                                    <p class="text-xl font-bold text-gray-900" x-text="selectedVisit.vitals.bp"></p>
                                </div>
                                <div class="bg-blue-50 rounded-xl p-4 border border-blue-200">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <i data-lucide="activity" class="w-5 h-5 text-blue-600"></i>
                                        <p class="text-xs font-bold text-gray-600">Pulse Rate</p>
                                    </div>
                                    <p class="text-xl font-bold text-gray-900" x-text="selectedVisit.vitals.pulse"></p>
                                </div>
                                <div class="bg-orange-50 rounded-xl p-4 border border-orange-200">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <i data-lucide="thermometer" class="w-5 h-5 text-orange-600"></i>
                                        <p class="text-xs font-bold text-gray-600">Temperature</p>
                                    </div>
                                    <p class="text-xl font-bold text-gray-900" x-text="selectedVisit.vitals.temp"></p>
                                </div>
                                <div class="bg-green-50 rounded-xl p-4 border border-green-200">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <i data-lucide="weight" class="w-5 h-5 text-green-600"></i>
                                        <p class="text-xs font-bold text-gray-600">Weight</p>
                                    </div>
                                    <p class="text-xl font-bold text-gray-900" x-text="selectedVisit.vitals.weight"></p>
                                </div>
                                <div class="bg-purple-50 rounded-xl p-4 border border-purple-200">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <i data-lucide="ruler" class="w-5 h-5 text-purple-600"></i>
                                        <p class="text-xs font-bold text-gray-600">BMI</p>
                                    </div>
                                    <p class="text-xl font-bold text-gray-900" x-text="selectedVisit.vitals.bmi"></p>
                                </div>
                                <div class="bg-indigo-50 rounded-xl p-4 border border-indigo-200">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <i data-lucide="wind" class="w-5 h-5 text-indigo-600"></i>
                                        <p class="text-xs font-bold text-gray-600">Respiratory</p>
                                    </div>
                                    <p class="text-xl font-bold text-gray-900" x-text="selectedVisit.vitals.respiratory"></p>
                                </div>
                            </div>
                        </div>

                        <!-- Complete Assessment -->
                        <div class="bg-gray-50 rounded-xl p-6">
                            <h4 class="text-lg font-bold text-gray-900 mb-4">Clinical Assessment</h4>
                            <div class="space-y-4">
                                <div>
                                    <p class="text-sm font-bold text-gray-600 mb-1">Presenting Complaints</p>
                                    <p class="text-sm text-gray-800" x-text="selectedVisit.complaints"></p>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <p class="text-sm font-bold text-gray-600 mb-1">Diagnosis</p>
                                        <p class="text-sm text-gray-800 font-medium" x-text="selectedVisit.diagnosis"></p>
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-gray-600 mb-1">Differential Diagnosis</p>
                                        <p class="text-sm text-gray-800" x-text="selectedVisit.differentialDiagnosis"></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Complete Treatment Plan -->
                        <div>
                            <h4 class="text-lg font-bold text-gray-900 mb-4">Complete Treatment Plan</h4>
                            <div class="space-y-3">
                                <template x-for="(med, index) in selectedVisit.medications" :key="index">
                                    <div class="bg-purple-50 rounded-xl p-4 border-l-4 border-purple-600">
                                        <div class="flex items-start justify-between">
                                            <div>
                                                <p class="font-bold text-gray-900" x-text="med.name"></p>
                                                <div class="mt-2 grid grid-cols-3 gap-4 text-sm">
                                                    <div>
                                                        <p class="text-xs text-gray-500">Dosage</p>
                                                        <p class="font-semibold text-gray-700" x-text="med.dose"></p>
                                                    </div>
                                                    <div>
                                                        <p class="text-xs text-gray-500">Frequency</p>
                                                        <p class="font-semibold text-gray-700" x-text="med.frequency"></p>
                                                    </div>
                                                    <div>
                                                        <p class="text-xs text-gray-500">Duration</p>
                                                        <p class="font-semibold text-gray-700" x-text="med.duration"></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Modal Footer -->
                    <div class="bg-gray-50 px-6 py-4 rounded-b-2xl flex flex-col sm:flex-row gap-3 justify-end border-t border-gray-200">
                        <button 
                            @click="printVisit(selectedVisit)"
                            class="px-6 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 transition flex items-center justify-center space-x-2"
                        >
                            <i data-lucide="printer" class="w-4 h-4"></i>
                            <span>Print</span>
                        </button>
                        <button 
                            @click="showVisitModal = false"
                            class="px-6 py-3 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-xl font-semibold hover:from-purple-700 hover:to-purple-800 transition shadow-lg"
                        >
                            Close
                        </button>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
        });

        document.addEventListener('alpine:initialized', () => {
            setInterval(() => {
                lucide.createIcons();
            }, 100);
        });
    </script>
</body>
</html>